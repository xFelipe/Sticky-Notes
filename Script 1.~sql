
--CRIANDO VIEW
CREATE OR REPLACE VIEW v_aluno
AS
  SELECT COD_ALUNO AS CODIGO, SALARIO, ESTADO,
                      NOME AS ALUNO, CIDADE
  FROM TALUNO
  WHERE ESTADO = 'RS';


--USANDO VIEW
SELECT * FROM V_ALUNO
ORDER BY ALUNO;


CREATE OR REPLACE VIEW V_CONTRATO_TOP
AS
  SELECT COD_CONTRATO, DESCONTO
  FROM TCONTRATO
  WHERE DESCONTO>=10;

SELECT * FROM V_CONTRATO_TOP;


--NOME E CONTEUDO DAS VIEWS
SELECT VIEW_NAME, TEXT
FROM USER_VIEWS;


--VIEW COM PARAMETRO DE SAÍDA
CREATE OR REPLACE VIEW V_ALUNO2
AS
  SELECT COD_ALUNO, NOME, SALARIO
  FROM TALUNO;

SELECT * FROM V_ALUNO2;



--VIEW COMPLEXA
CREATE OR REPLACE VIEW V_CONTRATO
AS
  SELECT Trunc(DATA) AS DATA,
         Max(DESCONTO) AS MAXIMO,
         Avg(DESCONTO) AS MEDIA,
         Count(*) AS QUANTIDADE
  FROM TCONTRATO
  GROUP BY DATA
  ORDER BY DATA;

SELECT * FROM V_CONTRATO;


--View Simples
CREATE OR REPLACE VIEW V_PESSOA_F
AS
  SELECT COD_PESSOA, TIPO, NOME, COD_RUA AS RUA
  FROM TPESSOA
  WHERE TIPO = 'F';

SELECT * FROM V_PESSOA_F;



--EXEMPLO DE CONSULTA USANDO VIEW E TABELA

SELECT PES.COD_PESSOA AS CODIGO,
       PES.NOME AS PESSOA,
       CID.NOME AS CIDADE,
       RUA.NOME AS RUA
FROM V_PESSOA_F PES, TRUA RUA, TCIDADE CID
WHERE PES.RUA = RUA.COD_RUA (+)
  AND CID.COD_CIDADE = RUA.COD_CIDADE;

SELECT * FROM V_PESSOA_F;
SELECT * FROM TRUA;
SELECT * FROM TCIDADE;

--/////////////////////


--OPERACAO DML NA VIEW COM RESTRIÇÃO
CREATE OR REPLACE VIEW vcursos1000ck
AS
    SELECT COD_CURSO, NOME, VALOR
    FROM TCURSO
    WHERE VALOR = 1000
    WITH CHECK OPTION CONSTRAINT vcursos1000_ck;

                              SELECT * FROM VCURSOS1000CK;
INSERT INTO VCURSOS1000CK
          (COD_CURSO, NOME, VALOR)
   VALUES (52, 'TESTE Y', 999);



